@page "/trasy"
@using front.Models
@inject front.Services.StacjeSerwis stacjeSerwis
@using Blazored.Typeahead

<div class="container mt-4">
    <form id="searchForm" class="row g-3 align-items-end">
        <div class="col-md-3">
            <label for="stacjaPoczatkowa" class="form-label">Stacja początkowa</label>
            <BlazoredTypeahead SearchMethod="SearchStacje"
                   Placeholder="Wpisz nazwę stacji..."
                   @bind-Value="@stacjaPoczatkowa"
                   Debounce="10"
                   id="stacjaPoczatkowa">
                <SelectedTemplate>
                    @context.StopName
                </SelectedTemplate>
                <ResultTemplate>
                    @context.StopName
                </ResultTemplate>
            </BlazoredTypeahead>
        </div>

        <div class="col-md-3">
            <label for="stacjaDocelowa" class="form-label">Stacja docelowa</label>
            <BlazoredTypeahead SearchMethod="SearchStacje"
                   Placeholder="Wpisz nazwę stacji..."
                   @bind-Value="@stacjaDocelowa"
                   Debounce="10"
                   id="stacjaDocelowa">
                <SelectedTemplate>
                    @context.StopName
                </SelectedTemplate>
                <ResultTemplate>
                    @context.StopName
                </ResultTemplate>
            </BlazoredTypeahead>
        </div>

        <div class="input-group" id="datetimepicker" data-td-target-input="nearest" data-td-target-toggle="nearest">
            <input type="text" class="form-control" data-td-target="#datetimepicker" placeholder="Wybierz datę" />
            <span class="input-group-text" data-td-target="#datetimepicker" data-td-toggle="datetimepicker">
                <i class="fa fa-calendar"></i>
            </span>
        </div>

        <div class="col-md-3">
            <button type="submit" class="btn btn-primary w-100">
                <i class="fa fa-search me-2"></i>Szukaj
            </button>
        </div>
    </form>

    <hr />

    <h5>Trasy</h5>
    <ul class="list-group" id="trasyList"></ul>

    <hr />

    <h5>Ulubione trasy</h5>
    <ul class="list-group" id="favouritesList"></ul>
</div>

@code {
    private List<Stop>? stacje = new();
    private Stop? stacjaPoczatkowa;
    private Stop? stacjaDocelowa;
    
    protected override async Task OnInitializedAsync()
    {
        stacje = await stacjeSerwis.GetStacje();
    }

    private Task<IEnumerable<Stop>> SearchStacje(string searchText)
    {
        if (string.IsNullOrWhiteSpace(searchText))
            return Task.FromResult(stacje.AsEnumerable());

        var wyniki = stacje
            .Where(s => s.StopName.Contains(searchText, StringComparison.OrdinalIgnoreCase));

        return Task.FromResult(wyniki);
    }
}